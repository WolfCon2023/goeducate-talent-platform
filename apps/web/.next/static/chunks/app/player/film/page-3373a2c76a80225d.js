(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[785],{2883:(e,t,r)=>{"use strict";r.d(t,{X:()=>s,n:()=>i});var l=r(7011);class s extends Error{constructor(e){super(e.message),this.name="ApiFetchError",this.status=e.status,this.code=e.code,this.details=e.details}}async function i(e,t){var r,i,a,n,o;let d=function(){let e=l.env.NEXT_PUBLIC_API_URL;if(!e)throw Error("Missing NEXT_PUBLIC_API_URL");return e.replace(/\/+$/,"")}(),c=new Headers(null==t?void 0:t.headers);c.set("content-type","application/json"),(null==t?void 0:t.token)&&c.set("authorization","Bearer ".concat(t.token));let u=await fetch("".concat(d).concat(e),{...t,headers:c,cache:"no-store"});if(!u.ok){let e=await u.json().catch(()=>({}));throw new s({message:null!=(n=null==(r=e.error)?void 0:r.message)?n:"Request failed: ".concat(u.status),status:u.status,code:null==(i=e.error)?void 0:i.code,details:null==(a=e.error)?void 0:a.details})}if(204===u.status)return;if(!(null!=(o=u.headers.get("content-type"))?o:"").includes("application/json")){let e=await u.text();if(!e)return;return e}let m=await u.text();if(m)return JSON.parse(m)}},3200:(e,t,r)=>{"use strict";r.d(t,{B:()=>i,_:()=>s});var l=r(2883);function s(e){if(e instanceof l.X){let t=e.details,r=(null==t?void 0:t.fieldErrors)&&"object"==typeof t.fieldErrors?t.fieldErrors:void 0,l=Array.isArray(null==t?void 0:t.formErrors)?t.formErrors:[];return{formError:[e.message,...l].filter(Boolean).join(" ")||e.message,fieldErrors:r}}return e instanceof Error?{formError:e.message}:{formError:"Something went wrong."}}function i(e,t){var r;let l=null==e?void 0:e[t];return l&&Array.isArray(l)&&0!==l.length&&null!=(r=l[0])?r:null}},3643:(e,t,r)=>{Promise.resolve().then(r.bind(r,8691)),Promise.resolve().then(r.bind(r,5241)),Promise.resolve().then(r.t.bind(r,9664,23))},3996:(e,t,r)=>{"use strict";r.d(t,{RoleGuard:()=>o});var l=r(4568),s=r(7541),i=r(7620),a=r(5979);let n={player:"/player",coach:"/coach",evaluator:"/evaluator",admin:"/admin"};function o(e){return!0!==function(e){let t=(0,s.useRouter)(),[r,l]=(0,i.useState)(null),o=e.join(",");return(0,i.useEffect)(()=>{let e=(0,a.iD)(),r=(0,a._u)(e);if(!e||!r){l(!1),t.push("/login");return}if(!new Set(o.split(",").filter(Boolean)).has(r)){var s;l(!1),t.push(null!=(s=n[r])?s:"/");return}l(!0)},[t,o]),r}(e.allowed)?null:(0,l.jsx)(l.Fragment,{children:e.children})}},4542:(e,t,r)=>{"use strict";r.d(t,{$n:()=>s,JU:()=>a,Zp:()=>n,pd:()=>i});var l=r(4568);function s(e){let{className:t="",...r}=e;return(0,l.jsx)("button",{className:"rounded-md bg-indigo-600 px-4 py-2 text-sm font-medium text-white hover:bg-indigo-500 disabled:opacity-60 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[color:var(--color-primary-600)] ".concat(t),...r})}function i(e){let{className:t="",...r}=e;return(0,l.jsx)("input",{className:"w-full rounded-md border border-[color:var(--border)] bg-[var(--surface-soft)] px-3 py-2 text-sm text-[color:var(--foreground)] placeholder:text-[color:var(--muted-3)] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[color:var(--color-primary-600)] ".concat(t),...r})}function a(e){return(0,l.jsx)("label",{htmlFor:e.htmlFor,className:"text-sm font-medium text-[color:var(--muted)]",children:e.children})}function n(e){return(0,l.jsx)("div",{className:"rounded-2xl border border-[color:var(--border)] bg-[var(--surface)] p-6",children:e.children})}},5241:(e,t,r)=>{"use strict";r.d(t,{FilmSubmissions:()=>f});var l=r(4568),s=r(9664),i=r.n(s),a=r(7620),n=r(8648),o=r(6015),d=r(4542),c=r(2883),u=r(5979),m=r(3200);function f(){let e=(0,n.S)(),[t,r]=(0,a.useState)(!1),[s,f]=(0,a.useState)(!1),[p,x]=(0,a.useState)(null),[v,h]=(0,a.useState)(void 0),[g,b]=(0,a.useState)([]),[j,w]=(0,a.useState)({}),[y,N]=(0,a.useState)({}),[_,E]=(0,a.useState)(""),[S,C]=(0,a.useState)(""),[P,k]=(0,a.useState)(""),[T,U]=(0,a.useState)(""),[D,R]=(0,a.useState)(null),[F,O]=(0,a.useState)(""),[I,A]=(0,a.useState)(!1),J=!_.trim(),L=(0,a.useCallback)(async()=>{x(null),h(void 0),r(!0);try{let e=(0,u.iD)();if(!e)throw Error("Please login as a player first.");let t=(0,u._u)(e);if(t&&"player"!==t)throw Error("This page is only available to player accounts.");let r=await (0,c.n)("/film-submissions/me",{token:e});b(r.results);let l=r.results.filter(e=>"completed"===e.status).slice(0,10);await Promise.all(l.map(async e=>{void 0===j[e._id]&&await G(e._id)}))}catch(t){var e;x(null!=(e=(0,m._)(t).formError)?e:"Failed to load submissions")}finally{r(!1)}},[]);async function G(e){x(null),N(t=>({...t,[e]:!0}));try{let t=(0,u.iD)(),r=(0,u._u)(t);if(!t)throw Error("Please login as a player first.");if(r&&"player"!==r)throw Error("This page is only available to player accounts.");let l=await (0,c.n)("/evaluations/film/".concat(e),{token:t});w(t=>({...t,[e]:l}))}catch(r){let t=r instanceof Error?r.message:"Failed to load evaluation";"Evaluation not found"===t?w(t=>({...t,[e]:null})):x(t)}finally{N(t=>({...t,[e]:!1}))}}async function $(e){var t,r;x(null),h(void 0),A(!0);try{if(!_.trim()){let t=e.name.replace(/\.[^/.]+$/,"");E(t)}let r=(0,u.iD)(),l=(0,u._u)(r);if(!r)throw Error("Please login as a player first.");if(l&&"player"!==l)throw Error("This page is only available to player accounts.");let s=await (0,c.n)("/uploads/cloudinary/sign",{method:"POST",token:r,body:JSON.stringify({resourceType:"video"})}),i=new FormData;i.append("file",e),i.append("api_key",s.apiKey),i.append("timestamp",String(s.timestamp)),i.append("signature",s.signature),i.append("folder",s.folder);let a=await fetch("https://api.cloudinary.com/v1_1/".concat(encodeURIComponent(s.cloudName),"/").concat(encodeURIComponent(s.resourceType),"/upload"),{method:"POST",body:i});if(!a.ok){let e=await a.text();throw Error("Upload failed: ".concat(a.status," ").concat(e))}let n=await a.json();if(!n.secure_url)throw Error("Upload failed: missing secure_url");U(n.secure_url),R(null!=(t=n.public_id)?t:null)}catch(t){let e=(0,m._)(t);x(null!=(r=e.formError)?r:"Upload failed"),h(e.fieldErrors)}finally{A(!1)}}async function B(){x(null),h(void 0),f(!0);try{let e={};if(_.trim()||(e.title=["Title is required."]),Object.keys(e).length>0)return void h(e);let t=(0,u.iD)();if(!t)throw Error("Please login as a player first.");let r=(0,u._u)(t);if(r&&"player"!==r)throw Error("This page is only available to player accounts.");await (0,c.n)("/film-submissions",{method:"POST",token:t,body:JSON.stringify({title:_,opponent:S||void 0,gameDate:P?new Date(P).toISOString():void 0,videoUrl:T||void 0,cloudinaryPublicId:D||void 0,notes:F||void 0})}),E(""),C(""),k(""),U(""),R(null),O(""),await L()}catch(r){var e;let t=(0,m._)(r);x(null!=(e=t.formError)?e:"Failed to create submission"),h(t.fieldErrors)}finally{f(!1)}}async function X(t){if(await e({title:"Delete submission?",message:"Delete this submission? This cannot be undone.",confirmText:"Delete",cancelText:"Cancel",destructive:!0})){x(null);try{let e=(0,u.iD)(),r=(0,u._u)(e);if(!e)throw Error("Please login as a player first.");if(r&&"player"!==r)throw Error("This page is only available to player accounts.");await (0,c.n)("/film-submissions/".concat(t),{method:"DELETE",token:e}),await L()}catch(e){var r;x(null!=(r=(0,m._)(e).formError)?r:"Failed to delete submission")}}}return(0,a.useEffect)(()=>{L()},[L]),(0,l.jsxs)("div",{className:"grid gap-6",children:[(0,l.jsxs)(d.Zp,{children:[(0,l.jsx)(o.N,{formError:null!=p?p:void 0,fieldErrors:v}),(0,l.jsx)("h2",{className:"text-lg font-semibold",children:"Submit film"}),(0,l.jsx)("p",{className:"mt-1 text-sm text-[color:var(--muted)]",children:"Add game film metadata. You can upload a video file or paste a hosted video URL."}),(0,l.jsxs)("div",{className:"mt-6 grid gap-4 sm:grid-cols-2",children:[(0,l.jsxs)("div",{className:"grid gap-2 sm:col-span-2",children:[(0,l.jsx)(d.JU,{htmlFor:"title",children:"Title"}),(0,l.jsx)(d.pd,{id:"title",value:_,onChange:e=>E(e.target.value),placeholder:"Week 3 vs Central"}),(0,l.jsx)(o.b,{name:"title",fieldErrors:v}),J?(0,l.jsx)("p",{className:"text-xs text-[color:var(--muted-2)]",children:"Title is required."}):null]}),(0,l.jsxs)("div",{className:"grid gap-2",children:[(0,l.jsx)(d.JU,{htmlFor:"opponent",children:"Opponent"}),(0,l.jsx)(d.pd,{id:"opponent",value:S,onChange:e=>C(e.target.value),placeholder:"Central HS"})]}),(0,l.jsxs)("div",{className:"grid gap-2",children:[(0,l.jsx)(d.JU,{htmlFor:"gameDate",children:"Game date"}),(0,l.jsx)(d.pd,{id:"gameDate",type:"date",value:P,onChange:e=>k(e.target.value)})]}),(0,l.jsxs)("div",{className:"grid gap-2 sm:col-span-2",children:[(0,l.jsx)(d.JU,{htmlFor:"videoUrl",children:"Video URL (optional)"}),(0,l.jsx)(d.pd,{id:"videoUrl",value:T,onChange:e=>U(e.target.value),placeholder:"https://..."}),(0,l.jsxs)("div",{className:"mt-2 flex flex-wrap items-center gap-3",children:[(0,l.jsx)("input",{type:"file",accept:"video/*",disabled:I,onChange:e=>{var t;let r=null==(t=e.target.files)?void 0:t[0];r&&$(r)},className:"text-sm text-[color:var(--muted)] file:mr-4 file:rounded-md file:border-0 file:bg-indigo-600 file:px-3 file:py-2 file:text-sm file:font-medium file:text-white hover:file:bg-indigo-500"}),(0,l.jsx)("span",{className:"text-xs text-[color:var(--muted-3)]",children:I?"Uploading...":"Upload a file to auto-fill the Video URL (Cloudinary)."})]})]}),(0,l.jsxs)("div",{className:"grid gap-2 sm:col-span-2",children:[(0,l.jsx)(d.JU,{htmlFor:"notes",children:"Notes (optional)"}),(0,l.jsx)("textarea",{id:"notes",className:"min-h-28 w-full rounded-md border border-[color:var(--border)] bg-[var(--surface-soft)] px-3 py-2 text-sm text-[color:var(--foreground)] placeholder:text-[color:var(--muted-3)] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[color:var(--color-primary-600)]",value:F,onChange:e=>O(e.target.value),placeholder:"Anything you want evaluators to focus on..."})]})]}),(0,l.jsxs)("div",{className:"mt-4 flex items-center gap-3",children:[(0,l.jsx)(d.$n,{type:"button",onClick:B,disabled:s||I||J,children:I?"Uploading...":s?"Submitting...":"Submit"}),p?(0,l.jsx)("p",{className:"text-sm text-red-300",children:p}):null]})]}),(0,l.jsxs)(d.Zp,{children:[(0,l.jsxs)("div",{className:"flex items-start justify-between gap-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("h2",{className:"text-lg font-semibold",children:"Your submissions"}),(0,l.jsx)("p",{className:"mt-1 text-sm text-[color:var(--muted)]",children:"Status is shown for evaluator workflow."})]}),(0,l.jsx)(d.$n,{type:"button",onClick:L,disabled:t,children:t?"Refreshing...":"Refresh"})]}),(0,l.jsxs)("div",{className:"mt-6 grid gap-3",children:[g.map(e=>(0,l.jsxs)("div",{className:"rounded-2xl border border-[color:var(--border)] bg-[var(--surface-soft)] p-4",children:[(0,l.jsxs)("div",{className:"flex flex-wrap items-baseline justify-between gap-2",children:[(0,l.jsx)("div",{className:"font-semibold",children:e.title}),(0,l.jsx)("div",{className:"text-xs uppercase tracking-wide ".concat("completed"===e.status?"text-emerald-300":"in_review"===e.status?"text-amber-300":"needs_changes"===e.status?"text-red-300":"text-[color:var(--muted-2)]"),children:e.status.replace("_"," ")})]}),(0,l.jsxs)("div",{className:"mt-1 text-sm text-[color:var(--muted)]",children:[e.opponent?(0,l.jsxs)(l.Fragment,{children:["Opponent: ",e.opponent]}):null,e.opponent&&e.gameDate?" \xb7 ":null,e.gameDate?(0,l.jsxs)(l.Fragment,{children:["Game date: ",new Date(e.gameDate).toLocaleDateString()]}):null]}),e.videoUrl?(0,l.jsx)("div",{className:"mt-2 text-sm",children:(0,l.jsx)("a",{className:"text-indigo-300 hover:text-indigo-200 hover:underline",href:e.videoUrl,target:"_blank",rel:"noreferrer",children:"View video link"})}):null,e.notes?(0,l.jsx)("p",{className:"mt-2 text-sm text-[color:var(--muted)]",children:e.notes}):null,"completed"===e.status?(0,l.jsxs)("div",{className:"mt-4",children:[(0,l.jsxs)("div",{className:"flex flex-wrap items-center gap-3",children:[(0,l.jsx)(i(),{href:"/player/film/".concat(e._id),className:"rounded-md bg-indigo-600 px-4 py-2 text-sm font-medium text-white hover:bg-indigo-500",children:"Open evaluation"}),(0,l.jsx)(d.$n,{type:"button",onClick:()=>G(e._id),disabled:!!y[e._id],children:y[e._id]?"Loading...":"Refresh report"})]}),j[e._id]?(0,l.jsxs)("div",{className:"mt-4 rounded-2xl border border-[color:var(--border)] bg-[var(--surface)] p-4",children:[(0,l.jsxs)("div",{className:"flex flex-wrap items-baseline justify-between gap-2",children:[(0,l.jsx)("div",{className:"font-semibold",children:"Evaluation"}),(0,l.jsxs)("div",{className:"text-sm text-[color:var(--muted)]",children:["Grade: ",j[e._id].overallGrade,"/10"]})]}),(0,l.jsxs)("div",{className:"mt-3 grid gap-3 text-sm text-[color:var(--foreground)]",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"text-xs uppercase tracking-wide text-[color:var(--muted-2)]",children:"Strengths"}),(0,l.jsx)("div",{className:"mt-1 whitespace-pre-wrap",children:j[e._id].strengths})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"text-xs uppercase tracking-wide text-[color:var(--muted-2)]",children:"Improvements"}),(0,l.jsx)("div",{className:"mt-1 whitespace-pre-wrap",children:j[e._id].improvements})]}),j[e._id].notes?(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"text-xs uppercase tracking-wide text-[color:var(--muted-2)]",children:"Notes"}),(0,l.jsx)("div",{className:"mt-1 whitespace-pre-wrap",children:j[e._id].notes})]}):null]})]}):null===j[e._id]?(0,l.jsx)("p",{className:"mt-3 text-sm text-[color:var(--muted)]",children:"No evaluation yet."}):null]}):"in_review"===e.status?(0,l.jsx)("p",{className:"mt-4 text-sm text-[color:var(--muted)]",children:"In review. An evaluator is working on your film."}):"needs_changes"===e.status?(0,l.jsxs)("div",{className:"mt-4 flex flex-wrap items-center justify-between gap-3",children:[(0,l.jsx)("p",{className:"text-sm text-red-200",children:"Needs changes. Please review feedback and resubmit if needed."}),(0,l.jsx)(d.$n,{type:"button",onClick:()=>X(e._id),children:"Delete"})]}):(0,l.jsxs)("div",{className:"mt-4 flex flex-wrap items-center justify-between gap-3",children:[(0,l.jsx)("p",{className:"text-sm text-[color:var(--muted-2)]",children:"Submitted. Waiting for evaluator review."}),(0,l.jsx)(d.$n,{type:"button",onClick:()=>X(e._id),children:"Delete"})]})]},e._id)),0===g.length?(0,l.jsx)("p",{className:"text-sm text-[color:var(--muted-2)]",children:"No submissions yet."}):null]})]})]})}},5979:(e,t,r)=>{"use strict";r.d(t,{QG:()=>n,_u:()=>a,bZ:()=>d,iD:()=>s,ki:()=>o});let l="goeducate_access_token";function s(){return window.localStorage.getItem(l)}function i(e){let t="=".repeat((4-e.length%4)%4);return decodeURIComponent(atob((e+t).replace(/-/g,"+").replace(/_/g,"/")).split("").map(e=>"%".concat(e.charCodeAt(0).toString(16).padStart(2,"0"))).join(""))}function a(e){if(!e)return null;let t=e.split(".");if(3!==t.length)return null;try{var r;let e=JSON.parse(i(null!=(r=t[1])?r:""));return"string"==typeof(null==e?void 0:e.role)?e.role:null}catch(e){return null}}function n(e){if(!e)return null;let t=e.split(".");if(3!==t.length)return null;try{var r;let e=JSON.parse(i(null!=(r=t[1])?r:""));return"string"==typeof(null==e?void 0:e.sub)?e.sub:null}catch(e){return null}}function o(e){window.localStorage.setItem(l,e)}function d(){window.localStorage.removeItem(l)}},6015:(e,t,r)=>{"use strict";r.d(t,{N:()=>i,b:()=>a});var l=r(4568),s=r(3200);function i(e){var t,r;let s=Object.entries(null!=(t=e.fieldErrors)?t:{}).filter(e=>{let[,t]=e;return Array.isArray(t)&&t.length>0});return e.formError||s.length>0?(0,l.jsxs)("div",{className:"rounded-xl border border-red-400/30 bg-red-500/10 p-4",children:[(0,l.jsx)("div",{className:"text-sm font-semibold text-red-200",children:null!=(r=e.title)?r:"Please fix the following:"}),(0,l.jsxs)("div",{className:"mt-2 grid gap-1 text-sm text-red-100",children:[e.formError?(0,l.jsx)("div",{children:e.formError}):null,s.length?(0,l.jsx)("ul",{className:"list-disc pl-5",children:s.slice(0,8).map(e=>{let[t,r]=e;return(0,l.jsxs)("li",{children:[(0,l.jsxs)("span",{className:"font-semibold",children:[t,":"]})," ",r[0]]},t)})}):null]})]}):null}function a(e){let t=(0,s.B)(e.fieldErrors,e.name);return t?(0,l.jsx)("div",{className:"text-sm text-red-300",children:t}):null}},7541:(e,t,r)=>{"use strict";var l=r(3041);r.o(l,"useParams")&&r.d(t,{useParams:function(){return l.useParams}}),r.o(l,"usePathname")&&r.d(t,{usePathname:function(){return l.usePathname}}),r.o(l,"useRouter")&&r.d(t,{useRouter:function(){return l.useRouter}}),r.o(l,"useSearchParams")&&r.d(t,{useSearchParams:function(){return l.useSearchParams}})},8648:(e,t,r)=>{"use strict";r.d(t,{ConfirmProvider:()=>a,S:()=>n});var l=r(4568),s=r(7620);let i=(0,s.createContext)(null);function a(e){let[t,r]=(0,s.useState)({open:!1,title:"Confirm",message:"",confirmText:"Confirm",cancelText:"Cancel",destructive:!1}),a=(0,s.useMemo)(()=>e=>new Promise(t=>{var l,s,i;r({open:!0,title:null!=(l=e.title)?l:"Confirm",message:e.message,confirmText:null!=(s=e.confirmText)?s:"Confirm",cancelText:null!=(i=e.cancelText)?i:"Cancel",destructive:!!e.destructive,resolve:t})}),[]);function n(e){let l=t.resolve;r(e=>({...e,open:!1,resolve:void 0})),null==l||l(e)}return(0,l.jsxs)(i.Provider,{value:a,children:[e.children,t.open?(0,l.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[(0,l.jsx)("div",{className:"absolute inset-0 bg-black/70",onClick:()=>n(!1)}),(0,l.jsxs)("div",{className:"relative w-full max-w-lg rounded-2xl border border-[color:var(--border)] bg-[var(--surface)] p-6 shadow-2xl",children:[(0,l.jsx)("div",{className:"text-lg font-semibold text-[color:var(--foreground)]",children:t.title}),(0,l.jsx)("p",{className:"mt-2 whitespace-pre-wrap text-sm text-[color:var(--muted)]",children:t.message}),(0,l.jsxs)("div",{className:"mt-6 flex flex-wrap justify-end gap-3",children:[(0,l.jsx)("button",{type:"button",className:"rounded-md border border-[color:var(--border)] bg-[var(--surface-soft)] px-4 py-2 text-sm font-medium text-[color:var(--foreground)] hover:bg-[var(--surface)] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-white/60",onClick:()=>n(!1),children:t.cancelText}),(0,l.jsx)("button",{type:"button",className:"rounded-md px-4 py-2 text-sm font-medium ".concat(t.destructive?"bg-red-500 text-white hover:bg-red-600 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-white/60":"bg-indigo-600 text-white hover:bg-indigo-500 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-white/60"),onClick:()=>n(!0),children:t.confirmText})]})]})]}):null]})}function n(){let e=(0,s.useContext)(i);if(!e)throw Error("useConfirm must be used within ConfirmProvider");return e}},8691:(e,t,r)=>{"use strict";r.d(t,{PlayerGuard:()=>i});var l=r(4568),s=r(3996);function i(e){return(0,l.jsx)(s.RoleGuard,{allowed:["player"],children:e.children})}}},e=>{e.O(0,[664,587,18,358],()=>e(e.s=3643)),_N_E=e.O()}]);