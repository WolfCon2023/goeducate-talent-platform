(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[232],{2883:(e,t,r)=>{"use strict";r.d(t,{X:()=>s,n:()=>n});var i=r(7011);class s extends Error{constructor(e){super(e.message),this.name="ApiFetchError",this.status=e.status,this.code=e.code,this.details=e.details}}async function n(e,t){var r,n,a,l,o;let c=function(){let e=i.env.NEXT_PUBLIC_API_URL;if(!e)throw Error("Missing NEXT_PUBLIC_API_URL");return e.replace(/\/+$/,"")}(),u=new Headers(null==t?void 0:t.headers);u.set("content-type","application/json"),(null==t?void 0:t.token)&&u.set("authorization","Bearer ".concat(t.token));let d=await fetch("".concat(c).concat(e),{...t,headers:u,cache:"no-store"});if(!d.ok){let e=await d.json().catch(()=>({}));throw new s({message:null!=(l=null==(r=e.error)?void 0:r.message)?l:"Request failed: ".concat(d.status),status:d.status,code:null==(n=e.error)?void 0:n.code,details:null==(a=e.error)?void 0:a.details})}if(204===d.status)return;if(!(null!=(o=d.headers.get("content-type"))?o:"").includes("application/json")){let e=await d.text();if(!e)return;return e}let m=await d.text();if(m)return JSON.parse(m)}},3996:(e,t,r)=>{"use strict";r.d(t,{RoleGuard:()=>o});var i=r(4568),s=r(7541),n=r(7620),a=r(5979);let l={player:"/player",coach:"/coach",evaluator:"/evaluator",admin:"/admin"};function o(e){return!0!==function(e){let t=(0,s.useRouter)(),[r,i]=(0,n.useState)(null),o=e.join(",");return(0,n.useEffect)(()=>{let e=(0,a.iD)(),r=(0,a._u)(e);if(!e||!r){i(!1),t.push("/login");return}if(!new Set(o.split(",").filter(Boolean)).has(r)){var s;i(!1),t.push(null!=(s=l[r])?s:"/");return}i(!0)},[t,o]),r}(e.allowed)?null:(0,i.jsx)(i.Fragment,{children:e.children})}},4024:(e,t,r)=>{"use strict";r.d(t,{EvaluatorQueue:()=>c});var i=r(4568),s=r(7620),n=r(4542),a=r(2883),l=r(5979),o=r(8648);function c(){let e=(0,o.S)(),[t,r]=(0,s.useState)(!1),[c,u]=(0,s.useState)(null),[d,m]=(0,s.useState)([]),[f,h]=(0,s.useState)(()=>"evaluator"===(0,l._u)((0,l.iD)())?"mine":"all"),x=(0,s.useCallback)(async()=>{u(null),r(!0);try{let e=(0,l.iD)(),t=(0,l._u)(e);if(!e)throw Error("Please login first.");if("evaluator"!==t&&"admin"!==t)throw Error("Insufficient permissions.");let r="mine"===f?"?mine=1":"",i=await (0,a.n)("/film-submissions/queue".concat(r),{token:e});m(i.results)}catch(e){u(e instanceof Error?e.message:"Failed to load queue")}finally{r(!1)}},[f]);async function g(e){u(null);try{let t=(0,l.iD)(),r=(0,l._u)(t);if(!t)throw Error("Please login first.");if("evaluator"!==r&&"admin"!==r)throw Error("Insufficient permissions.");await (0,a.n)("/film-submissions/".concat(e,"/assignment"),{method:"PATCH",token:t,body:JSON.stringify({action:"assign_to_me"})}),await x()}catch(e){u(e instanceof Error?e.message:"Failed to assign")}}async function p(e){u(null);try{let t=(0,l.iD)(),r=(0,l._u)(t);if(!t)throw Error("Please login first.");if("evaluator"!==r&&"admin"!==r)throw Error("Insufficient permissions.");await (0,a.n)("/film-submissions/".concat(e,"/assignment"),{method:"PATCH",token:t,body:JSON.stringify({action:"unassign"})}),await x()}catch(e){u(e instanceof Error?e.message:"Failed to unassign")}}async function v(e){u(null);try{let t=(0,l.iD)(),r=(0,l._u)(t);if(!t)throw Error("Please login first.");if("evaluator"!==r&&"admin"!==r)throw Error("Insufficient permissions.");await (0,a.n)("/film-submissions/".concat(e,"/status"),{method:"PATCH",token:t,body:JSON.stringify({status:"in_review"})}),await x()}catch(e){u(e instanceof Error?e.message:"Failed to update status")}}async function b(t){if(await e({title:"Return submission for edits?",message:"This will move the submission to Needs changes and notify the player.",confirmText:"Return",cancelText:"Cancel",destructive:!0})){u(null);try{let e=(0,l.iD)(),r=(0,l._u)(e);if(!e)throw Error("Please login first.");if("evaluator"!==r&&"admin"!==r)throw Error("Insufficient permissions.");await (0,a.n)("/film-submissions/".concat(t,"/status"),{method:"PATCH",token:e,body:JSON.stringify({status:"needs_changes"})}),await x()}catch(e){u(e instanceof Error?e.message:"Failed to return for edits")}}}return(0,s.useEffect)(()=>{x()},[x]),(0,i.jsxs)(n.Zp,{children:[(0,i.jsxs)("div",{className:"flex items-start justify-between gap-4",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("h2",{className:"text-lg font-semibold",children:"Queue"}),(0,i.jsx)("p",{className:"mt-1 text-sm text-white/80",children:"Includes submitted and in-review. Oldest first."})]}),(0,i.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,i.jsxs)("div",{className:"flex items-center gap-2 rounded-2xl border border-white/10 bg-white/5 p-1",children:[(0,i.jsx)("button",{type:"button",onClick:()=>h("all"),className:"rounded-xl px-3 py-1.5 text-sm ".concat("all"===f?"bg-indigo-600 text-white":"text-white/80 hover:bg-white/10"),children:"All"}),(0,i.jsx)("button",{type:"button",onClick:()=>h("mine"),className:"rounded-xl px-3 py-1.5 text-sm ".concat("mine"===f?"bg-indigo-600 text-white":"text-white/80 hover:bg-white/10"),children:"My queue"})]}),(0,i.jsx)(n.$n,{type:"button",onClick:x,disabled:t,children:t?"Refreshing...":"Refresh"})]})]}),c?(0,i.jsx)("p",{className:"mt-4 text-sm text-red-300",children:c}):null,(0,i.jsxs)("div",{className:"mt-6 grid gap-3",children:[d.map(e=>{var r,s;let a=(0,l.iD)(),o=(0,l.QG)(a),c=o&&e.assignedEvaluatorUserId&&String(e.assignedEvaluatorUserId)===String(o),u=(null==(r=e.assignedEvaluator)?void 0:r.email)?"Assigned: ".concat(e.assignedEvaluator.email):e.assignedEvaluatorUserId?"Assigned":"Unassigned";return(0,i.jsxs)("div",{className:"rounded-2xl border border-white/10 bg-white/5 p-4",children:[(0,i.jsxs)("div",{className:"flex flex-wrap items-baseline justify-between gap-2",children:[(0,i.jsx)("div",{className:"font-semibold",children:e.title}),(0,i.jsx)("div",{className:"text-xs uppercase tracking-wide text-white/70",children:e.status.replace("_"," ")})]}),(0,i.jsxs)("div",{className:"mt-1 text-sm text-white/80",children:[e.opponent?(0,i.jsxs)(i.Fragment,{children:["Opponent: ",e.opponent]}):null,e.opponent&&e.gameDate?" \xb7 ":null,e.gameDate?(0,i.jsxs)(i.Fragment,{children:["Game date: ",new Date(e.gameDate).toLocaleDateString()]}):null]}),(0,i.jsx)("div",{className:"mt-2 text-xs text-white/60",children:u}),(0,i.jsx)("div",{className:"mt-2 text-xs text-white/60",children:(null==(s=e.playerProfile)?void 0:s.firstName)?(0,i.jsxs)(i.Fragment,{children:["Player: ",e.playerProfile.firstName," ",e.playerProfile.lastName,e.playerProfile.position?" \xb7 ".concat(e.playerProfile.position):"","number"==typeof e.playerProfile.gradYear?" \xb7 ".concat(e.playerProfile.gradYear):"",e.playerProfile.city&&e.playerProfile.state?" \xb7 ".concat(e.playerProfile.city,", ").concat(e.playerProfile.state):""]}):(0,i.jsx)(i.Fragment,{children:"Player: (profile not created yet)"})}),(0,i.jsxs)("div",{className:"mt-4 flex flex-wrap gap-2",children:[(0,i.jsx)(n.$n,{type:"button",onClick:()=>g(e._id),disabled:t||!!e.assignedEvaluatorUserId,children:"Assign to me"}),c?(0,i.jsx)(n.$n,{type:"button",className:"border border-white/15 bg-white/5 text-white hover:bg-white/10",onClick:()=>p(e._id),children:"Unassign"}):null,(0,i.jsx)(n.$n,{type:"button",onClick:()=>v(e._id),disabled:t||"submitted"!==e.status&&"needs_changes"!==e.status,children:"Mark in review"}),(0,i.jsx)(n.$n,{type:"button",className:"border border-white/15 bg-white/5 text-white hover:bg-white/10",onClick:()=>b(e._id),disabled:t||"in_review"!==e.status,children:"Return for edits"}),(0,i.jsx)("a",{className:"rounded-md border border-white/15 bg-white/5 px-4 py-2 text-sm font-medium text-white hover:bg-white/10",href:"/evaluator/film/".concat(e._id),children:"Complete evaluation"})]})]},e._id)}),0!==d.length||c?null:(0,i.jsx)("p",{className:"text-sm text-white/70",children:"No submissions in queue."})]})]})}},4542:(e,t,r)=>{"use strict";r.d(t,{$n:()=>s,JU:()=>a,Zp:()=>l,pd:()=>n});var i=r(4568);function s(e){let{className:t="",...r}=e;return(0,i.jsx)("button",{className:"rounded-md bg-indigo-600 px-4 py-2 text-sm font-medium text-white hover:bg-indigo-500 disabled:opacity-60 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[color:var(--color-primary-600)] ".concat(t),...r})}function n(e){let{className:t="",...r}=e;return(0,i.jsx)("input",{className:"w-full rounded-md border border-[color:var(--border)] bg-[var(--surface-soft)] px-3 py-2 text-sm text-[color:var(--foreground)] placeholder:text-[color:var(--muted-3)] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[color:var(--color-primary-600)] ".concat(t),...r})}function a(e){return(0,i.jsx)("label",{htmlFor:e.htmlFor,className:"text-sm font-medium text-[color:var(--muted)]",children:e.children})}function l(e){return(0,i.jsx)("div",{className:"rounded-2xl border border-[color:var(--border)] bg-[var(--surface)] p-6",children:e.children})}},5979:(e,t,r)=>{"use strict";r.d(t,{QG:()=>l,_u:()=>a,bZ:()=>c,iD:()=>s,ki:()=>o});let i="goeducate_access_token";function s(){return window.localStorage.getItem(i)}function n(e){let t="=".repeat((4-e.length%4)%4);return decodeURIComponent(atob((e+t).replace(/-/g,"+").replace(/_/g,"/")).split("").map(e=>"%".concat(e.charCodeAt(0).toString(16).padStart(2,"0"))).join(""))}function a(e){if(!e)return null;let t=e.split(".");if(3!==t.length)return null;try{var r;let e=JSON.parse(n(null!=(r=t[1])?r:""));return"string"==typeof(null==e?void 0:e.role)?e.role:null}catch(e){return null}}function l(e){if(!e)return null;let t=e.split(".");if(3!==t.length)return null;try{var r;let e=JSON.parse(n(null!=(r=t[1])?r:""));return"string"==typeof(null==e?void 0:e.sub)?e.sub:null}catch(e){return null}}function o(e){window.localStorage.setItem(i,e)}function c(){window.localStorage.removeItem(i)}},7541:(e,t,r)=>{"use strict";var i=r(3041);r.o(i,"useParams")&&r.d(t,{useParams:function(){return i.useParams}}),r.o(i,"usePathname")&&r.d(t,{usePathname:function(){return i.usePathname}}),r.o(i,"useRouter")&&r.d(t,{useRouter:function(){return i.useRouter}}),r.o(i,"useSearchParams")&&r.d(t,{useSearchParams:function(){return i.useSearchParams}})},8648:(e,t,r)=>{"use strict";r.d(t,{ConfirmProvider:()=>a,S:()=>l});var i=r(4568),s=r(7620);let n=(0,s.createContext)(null);function a(e){let[t,r]=(0,s.useState)({open:!1,title:"Confirm",message:"",confirmText:"Confirm",cancelText:"Cancel",destructive:!1}),a=(0,s.useMemo)(()=>e=>new Promise(t=>{var i,s,n;r({open:!0,title:null!=(i=e.title)?i:"Confirm",message:e.message,confirmText:null!=(s=e.confirmText)?s:"Confirm",cancelText:null!=(n=e.cancelText)?n:"Cancel",destructive:!!e.destructive,resolve:t})}),[]);function l(e){let i=t.resolve;r(e=>({...e,open:!1,resolve:void 0})),null==i||i(e)}return(0,i.jsxs)(n.Provider,{value:a,children:[e.children,t.open?(0,i.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[(0,i.jsx)("div",{className:"absolute inset-0 bg-black/70",onClick:()=>l(!1)}),(0,i.jsxs)("div",{className:"relative w-full max-w-lg rounded-2xl border border-[color:var(--border)] bg-[var(--surface)] p-6 shadow-2xl",children:[(0,i.jsx)("div",{className:"text-lg font-semibold text-[color:var(--foreground)]",children:t.title}),(0,i.jsx)("p",{className:"mt-2 whitespace-pre-wrap text-sm text-[color:var(--muted)]",children:t.message}),(0,i.jsxs)("div",{className:"mt-6 flex flex-wrap justify-end gap-3",children:[(0,i.jsx)("button",{type:"button",className:"rounded-md border border-[color:var(--border)] bg-[var(--surface-soft)] px-4 py-2 text-sm font-medium text-[color:var(--foreground)] hover:bg-[var(--surface)] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-white/60",onClick:()=>l(!1),children:t.cancelText}),(0,i.jsx)("button",{type:"button",className:"rounded-md px-4 py-2 text-sm font-medium ".concat(t.destructive?"bg-red-500 text-white hover:bg-red-600 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-white/60":"bg-indigo-600 text-white hover:bg-indigo-500 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-white/60"),onClick:()=>l(!0),children:t.confirmText})]})]})]}):null]})}function l(){let e=(0,s.useContext)(n);if(!e)throw Error("useConfirm must be used within ConfirmProvider");return e}},9269:(e,t,r)=>{Promise.resolve().then(r.bind(r,9754)),Promise.resolve().then(r.bind(r,4024)),Promise.resolve().then(r.t.bind(r,9664,23))},9754:(e,t,r)=>{"use strict";r.d(t,{EvaluatorGuard:()=>n});var i=r(4568),s=r(3996);function n(e){return(0,i.jsx)(s.RoleGuard,{allowed:["evaluator","admin"],children:e.children})}}},e=>{e.O(0,[664,587,18,358],()=>e(e.s=9269)),_N_E=e.O()}]);