(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[173],{1647:(e,t,r)=>{"use strict";r.d(t,{NotificationsCenter:()=>u});var n=r(4568),i=r(9664),o=r.n(i),s=r(7620),a=r(8648),l=r(4542),c=r(2883),d=r(5979);function u(){let e=(0,a.S)(),[t,r]=(0,s.useState)(!1),[i,u]=(0,s.useState)(null),[f,m]=(0,s.useState)([]);async function h(){u(null),r(!0);try{let e=(0,d.iD)();if(!e)throw Error("Please login first.");let t=await (0,c.n)("/notifications/me?limit=100",{token:e});m(t.results)}catch(e){u(e instanceof Error?e.message:"Failed to load notifications")}finally{r(!1)}}async function v(e){try{let t=(0,d.iD)();if(!t)throw Error("Please login first.");await (0,c.n)("/notifications/".concat(e,"/read"),{method:"PATCH",token:t}),await h(),window.dispatchEvent(new Event("goeducate:notifications-changed"))}catch(e){u(e instanceof Error?e.message:"Failed to mark read")}}async function x(t){if(await e({title:"Delete notification?",message:"Delete this notification? This cannot be undone.",confirmText:"Delete",cancelText:"Cancel",destructive:!0}))try{let e=(0,d.iD)();if(!e)throw Error("Please login first.");await (0,c.n)("/notifications/".concat(t),{method:"DELETE",token:e}),await h(),window.dispatchEvent(new Event("goeducate:notifications-changed"))}catch(e){u(e instanceof Error?e.message:"Failed to delete")}}async function g(){if(await e({title:"Delete all notifications?",message:"Delete all notifications in your queue? This cannot be undone.",confirmText:"Delete all",cancelText:"Cancel",destructive:!0}))try{let e=(0,d.iD)();if(!e)throw Error("Please login first.");await (0,c.n)("/notifications/me",{method:"DELETE",token:e}),await h(),window.dispatchEvent(new Event("goeducate:notifications-changed"))}catch(e){u(e instanceof Error?e.message:"Failed to delete all")}}async function b(){try{let e=(0,d.iD)();if(!e)throw Error("Please login first.");await (0,c.n)("/notifications/me/read?unreadOnly=1",{method:"PATCH",token:e}),await h(),window.dispatchEvent(new Event("goeducate:notifications-changed"))}catch(e){u(e instanceof Error?e.message:"Failed to mark all read")}}return(0,s.useEffect)(()=>{h()},[]),(0,n.jsxs)(l.Zp,{children:[(0,n.jsxs)("div",{className:"flex items-start justify-between gap-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h1",{className:"text-2xl font-semibold tracking-tight",children:"Notifications"}),(0,n.jsx)("p",{className:"mt-1 text-sm text-[color:var(--muted)]",children:"Film submissions, evaluations, and watchlist updates."})]}),(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)(l.$n,{type:"button",className:"border border-white/15 bg-white/5 text-white hover:bg-white/10",onClick:b,disabled:t||0===f.length,children:"Mark all read"}),(0,n.jsx)(l.$n,{type:"button",className:"border border-white/15 bg-white/5 text-white hover:bg-white/10",onClick:g,disabled:t||0===f.length,children:"Delete all"}),(0,n.jsx)(l.$n,{type:"button",onClick:h,disabled:t,children:t?"Refreshing...":"Refresh"})]})]}),i?(0,n.jsx)("p",{className:"mt-4 text-sm text-red-300",children:i}):null,(0,n.jsxs)("div",{className:"mt-6 grid gap-3",children:[f.map(e=>{let t=!e.readAt;return(0,n.jsx)("div",{className:"rounded-2xl border border-[color:var(--border)] p-4 ".concat(t?"bg-[var(--surface-soft)]":"bg-[var(--surface)]"),children:(0,n.jsxs)("div",{className:"flex flex-wrap items-start justify-between gap-3",children:[(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("div",{className:"font-semibold",children:e.title}),t?(0,n.jsx)("span",{className:"rounded-full border border-[color:var(--border)] bg-[var(--surface)] px-2 py-0.5 text-xs font-semibold text-[color:var(--muted-2)]",children:"New"}):null]}),(0,n.jsx)("div",{className:"mt-1 text-sm text-[color:var(--muted)]",children:e.message}),e.createdAt?(0,n.jsx)("div",{className:"mt-2 text-xs text-[color:var(--muted-2)]",children:new Date(e.createdAt).toLocaleString()}):null]}),(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[e.href?(0,n.jsx)(o(),{href:e.href,onClick:()=>{t&&v(e._id)},className:"rounded-md bg-indigo-600 px-4 py-2 text-sm font-medium text-white hover:bg-indigo-500",children:"Open"}):null,t?(0,n.jsx)(l.$n,{type:"button",onClick:()=>v(e._id),children:"Mark read"}):null,(0,n.jsx)(l.$n,{type:"button",className:"border border-white/15 bg-white/5 text-white hover:bg-white/10",onClick:()=>x(e._id),children:"Delete"})]})]})},e._id)}),0===f.length?(0,n.jsx)("p",{className:"text-sm text-[color:var(--muted)]",children:"No notifications yet."}):null]})]})}},2883:(e,t,r)=>{"use strict";r.d(t,{X:()=>i,n:()=>o});var n=r(7011);class i extends Error{constructor(e){super(e.message),this.name="ApiFetchError",this.status=e.status,this.code=e.code,this.details=e.details}}async function o(e,t){var r,o,s,a,l;let c=function(){let e=n.env.NEXT_PUBLIC_API_URL;if(!e)throw Error("Missing NEXT_PUBLIC_API_URL");return e.replace(/\/+$/,"")}(),d=new Headers(null==t?void 0:t.headers);d.set("content-type","application/json"),(null==t?void 0:t.token)&&d.set("authorization","Bearer ".concat(t.token));let u=await fetch("".concat(c).concat(e),{...t,headers:d,cache:"no-store"});if(!u.ok){let e=await u.json().catch(()=>({}));throw new i({message:null!=(a=null==(r=e.error)?void 0:r.message)?a:"Request failed: ".concat(u.status),status:u.status,code:null==(o=e.error)?void 0:o.code,details:null==(s=e.error)?void 0:s.details})}if(204===u.status)return;if(!(null!=(l=u.headers.get("content-type"))?l:"").includes("application/json")){let e=await u.text();if(!e)return;return e}let f=await u.text();if(f)return JSON.parse(f)}},3052:(e,t,r)=>{Promise.resolve().then(r.bind(r,1647)),Promise.resolve().then(r.bind(r,3996))},3996:(e,t,r)=>{"use strict";r.d(t,{RoleGuard:()=>l});var n=r(4568),i=r(7541),o=r(7620),s=r(5979);let a={player:"/player",coach:"/coach",evaluator:"/evaluator",admin:"/admin"};function l(e){return!0!==function(e){let t=(0,i.useRouter)(),[r,n]=(0,o.useState)(null),l=e.join(",");return(0,o.useEffect)(()=>{let e=(0,s.iD)(),r=(0,s._u)(e);if(!e||!r){n(!1),t.push("/login");return}if(!new Set(l.split(",").filter(Boolean)).has(r)){var i;n(!1),t.push(null!=(i=a[r])?i:"/");return}n(!0)},[t,l]),r}(e.allowed)?null:(0,n.jsx)(n.Fragment,{children:e.children})}},4542:(e,t,r)=>{"use strict";r.d(t,{$n:()=>i,JU:()=>s,Zp:()=>a,pd:()=>o});var n=r(4568);function i(e){let{className:t="",...r}=e;return(0,n.jsx)("button",{className:"rounded-md bg-indigo-600 px-4 py-2 text-sm font-medium text-white hover:bg-indigo-500 disabled:opacity-60 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[color:var(--color-primary-600)] ".concat(t),...r})}function o(e){let{className:t="",...r}=e;return(0,n.jsx)("input",{className:"w-full rounded-md border border-[color:var(--border)] bg-[var(--surface-soft)] px-3 py-2 text-sm text-[color:var(--foreground)] placeholder:text-[color:var(--muted-3)] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[color:var(--color-primary-600)] ".concat(t),...r})}function s(e){return(0,n.jsx)("label",{htmlFor:e.htmlFor,className:"text-sm font-medium text-[color:var(--muted)]",children:e.children})}function a(e){return(0,n.jsx)("div",{className:"rounded-2xl border border-[color:var(--border)] bg-[var(--surface)] p-6",children:e.children})}},5979:(e,t,r)=>{"use strict";r.d(t,{QG:()=>a,_u:()=>s,bZ:()=>c,iD:()=>i,ki:()=>l});let n="goeducate_access_token";function i(){return window.localStorage.getItem(n)}function o(e){let t="=".repeat((4-e.length%4)%4);return decodeURIComponent(atob((e+t).replace(/-/g,"+").replace(/_/g,"/")).split("").map(e=>"%".concat(e.charCodeAt(0).toString(16).padStart(2,"0"))).join(""))}function s(e){if(!e)return null;let t=e.split(".");if(3!==t.length)return null;try{var r;let e=JSON.parse(o(null!=(r=t[1])?r:""));return"string"==typeof(null==e?void 0:e.role)?e.role:null}catch(e){return null}}function a(e){if(!e)return null;let t=e.split(".");if(3!==t.length)return null;try{var r;let e=JSON.parse(o(null!=(r=t[1])?r:""));return"string"==typeof(null==e?void 0:e.sub)?e.sub:null}catch(e){return null}}function l(e){window.localStorage.setItem(n,e)}function c(){window.localStorage.removeItem(n)}},7541:(e,t,r)=>{"use strict";var n=r(3041);r.o(n,"useParams")&&r.d(t,{useParams:function(){return n.useParams}}),r.o(n,"usePathname")&&r.d(t,{usePathname:function(){return n.usePathname}}),r.o(n,"useRouter")&&r.d(t,{useRouter:function(){return n.useRouter}}),r.o(n,"useSearchParams")&&r.d(t,{useSearchParams:function(){return n.useSearchParams}})},8648:(e,t,r)=>{"use strict";r.d(t,{ConfirmProvider:()=>s,S:()=>a});var n=r(4568),i=r(7620);let o=(0,i.createContext)(null);function s(e){let[t,r]=(0,i.useState)({open:!1,title:"Confirm",message:"",confirmText:"Confirm",cancelText:"Cancel",destructive:!1}),s=(0,i.useMemo)(()=>e=>new Promise(t=>{var n,i,o;r({open:!0,title:null!=(n=e.title)?n:"Confirm",message:e.message,confirmText:null!=(i=e.confirmText)?i:"Confirm",cancelText:null!=(o=e.cancelText)?o:"Cancel",destructive:!!e.destructive,resolve:t})}),[]);function a(e){let n=t.resolve;r(e=>({...e,open:!1,resolve:void 0})),null==n||n(e)}return(0,n.jsxs)(o.Provider,{value:s,children:[e.children,t.open?(0,n.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[(0,n.jsx)("div",{className:"absolute inset-0 bg-black/70",onClick:()=>a(!1)}),(0,n.jsxs)("div",{className:"relative w-full max-w-lg rounded-2xl border border-[color:var(--border)] bg-[var(--surface)] p-6 shadow-2xl",children:[(0,n.jsx)("div",{className:"text-lg font-semibold text-[color:var(--foreground)]",children:t.title}),(0,n.jsx)("p",{className:"mt-2 whitespace-pre-wrap text-sm text-[color:var(--muted)]",children:t.message}),(0,n.jsxs)("div",{className:"mt-6 flex flex-wrap justify-end gap-3",children:[(0,n.jsx)("button",{type:"button",className:"rounded-md border border-[color:var(--border)] bg-[var(--surface-soft)] px-4 py-2 text-sm font-medium text-[color:var(--foreground)] hover:bg-[var(--surface)] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-white/60",onClick:()=>a(!1),children:t.cancelText}),(0,n.jsx)("button",{type:"button",className:"rounded-md px-4 py-2 text-sm font-medium ".concat(t.destructive?"bg-red-500 text-white hover:bg-red-600 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-white/60":"bg-indigo-600 text-white hover:bg-indigo-500 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-white/60"),onClick:()=>a(!0),children:t.confirmText})]})]})]}):null]})}function a(){let e=(0,i.useContext)(o);if(!e)throw Error("useConfirm must be used within ConfirmProvider");return e}}},e=>{e.O(0,[664,587,18,358],()=>e(e.s=3052)),_N_E=e.O()}]);