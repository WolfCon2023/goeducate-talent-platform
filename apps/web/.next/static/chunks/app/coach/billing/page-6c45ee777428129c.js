(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[923],{2515:(e,t,r)=>{"use strict";r.d(t,{CoachGuard:()=>a});var n=r(4568),o=r(3996);function a(e){return(0,n.jsx)(o.RoleGuard,{allowed:["coach","admin"],children:e.children})}},2883:(e,t,r)=>{"use strict";r.d(t,{X:()=>o,n:()=>a});var n=r(7011);class o extends Error{constructor(e){super(e.message),this.name="ApiFetchError",this.status=e.status,this.code=e.code,this.details=e.details}}async function a(e,t){var r,a,l,s,i;let c=function(){let e=n.env.NEXT_PUBLIC_API_URL;if(!e)throw Error("Missing NEXT_PUBLIC_API_URL");return e.replace(/\/+$/,"")}(),u=new Headers(null==t?void 0:t.headers);u.set("content-type","application/json"),(null==t?void 0:t.token)&&u.set("authorization","Bearer ".concat(t.token));let d=await fetch("".concat(c).concat(e),{...t,headers:u,cache:"no-store"});if(!d.ok){let e=await d.json().catch(()=>({}));throw new o({message:null!=(s=null==(r=e.error)?void 0:r.message)?s:"Request failed: ".concat(d.status),status:d.status,code:null==(a=e.error)?void 0:a.code,details:null==(l=e.error)?void 0:l.details})}if(204===d.status)return;if(!(null!=(i=d.headers.get("content-type"))?i:"").includes("application/json")){let e=await d.text();if(!e)return;return e}let h=await d.text();if(h)return JSON.parse(h)}},3996:(e,t,r)=>{"use strict";r.d(t,{RoleGuard:()=>i});var n=r(4568),o=r(7541),a=r(7620),l=r(5979);let s={player:"/player",coach:"/coach",evaluator:"/evaluator",admin:"/admin"};function i(e){return!0!==function(e){let t=(0,o.useRouter)(),[r,n]=(0,a.useState)(null),i=e.join(",");return(0,a.useEffect)(()=>{let e=(0,l.iD)(),r=(0,l._u)(e);if(!e||!r){n(!1),t.push("/login");return}if(!new Set(i.split(",").filter(Boolean)).has(r)){var o;n(!1),t.push(null!=(o=s[r])?o:"/");return}n(!0)},[t,i]),r}(e.allowed)?null:(0,n.jsx)(n.Fragment,{children:e.children})}},4542:(e,t,r)=>{"use strict";r.d(t,{$n:()=>o,JU:()=>l,Zp:()=>s,pd:()=>a});var n=r(4568);function o(e){let{className:t="",...r}=e;return(0,n.jsx)("button",{className:"rounded-md bg-indigo-600 px-4 py-2 text-sm font-medium text-white hover:bg-indigo-500 disabled:opacity-60 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[color:var(--color-primary-600)] ".concat(t),...r})}function a(e){let{className:t="",...r}=e;return(0,n.jsx)("input",{className:"w-full rounded-md border border-[color:var(--border)] bg-[var(--surface-soft)] px-3 py-2 text-sm text-[color:var(--foreground)] placeholder:text-[color:var(--muted-3)] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[color:var(--color-primary-600)] ".concat(t),...r})}function l(e){return(0,n.jsx)("label",{htmlFor:e.htmlFor,className:"text-sm font-medium text-[color:var(--muted)]",children:e.children})}function s(e){return(0,n.jsx)("div",{className:"rounded-2xl border border-[color:var(--border)] bg-[var(--surface)] p-6",children:e.children})}},5979:(e,t,r)=>{"use strict";r.d(t,{QG:()=>s,_u:()=>l,bZ:()=>c,iD:()=>o,ki:()=>i});let n="goeducate_access_token";function o(){return window.localStorage.getItem(n)}function a(e){let t="=".repeat((4-e.length%4)%4);return decodeURIComponent(atob((e+t).replace(/-/g,"+").replace(/_/g,"/")).split("").map(e=>"%".concat(e.charCodeAt(0).toString(16).padStart(2,"0"))).join(""))}function l(e){if(!e)return null;let t=e.split(".");if(3!==t.length)return null;try{var r;let e=JSON.parse(a(null!=(r=t[1])?r:""));return"string"==typeof(null==e?void 0:e.role)?e.role:null}catch(e){return null}}function s(e){if(!e)return null;let t=e.split(".");if(3!==t.length)return null;try{var r;let e=JSON.parse(a(null!=(r=t[1])?r:""));return"string"==typeof(null==e?void 0:e.sub)?e.sub:null}catch(e){return null}}function i(e){window.localStorage.setItem(n,e)}function c(){window.localStorage.removeItem(n)}},6355:(e,t,r)=>{"use strict";r.d(t,{CoachBilling:()=>i});var n=r(4568),o=r(7620),a=r(4542),l=r(2883),s=r(5979);function i(){var e,t;let[r,i]=(0,o.useState)(!1),[c,u]=(0,o.useState)(null),[d,h]=(0,o.useState)(null),[f,m]=(0,o.useState)("monthly"),p=(null==c?void 0:c.status)==="active",v=null!=(e=null==c?void 0:c.configured)&&e,g=null!=(t=null==c?void 0:c.hasSubscription)&&t,x=(0,o.useMemo)(()=>"annual"===f?"Annual":"Monthly",[f]);async function b(){h(null),i(!0);try{let e=(0,s.iD)(),t=(0,s._u)(e);if(!e)throw Error("Please login as a coach first.");if("coach"!==t&&"admin"!==t)throw Error("Insufficient permissions.");let r=await (0,l.n)("/billing/status",{token:e});u(r)}catch(e){h(e instanceof Error?e.message:"Failed to load billing status")}finally{i(!1)}}async function y(){h(null);try{let e=(0,s.iD)();if(!e)throw Error("Please login as a coach first.");let t=await (0,l.n)("/billing/checkout",{method:"POST",token:e,body:JSON.stringify({plan:f})});window.location.href=t.url}catch(e){h(e instanceof Error?e.message:"Failed to start checkout")}}async function w(){h(null);try{let e=(0,s.iD)();if(!e)throw Error("Please login as a coach first.");let t=await (0,l.n)("/billing/portal",{method:"POST",token:e});window.location.href=t.url}catch(e){h(e instanceof Error?e.message:"Failed to open billing portal")}}return(0,o.useEffect)(()=>{b()},[]),(0,n.jsx)("div",{className:"grid gap-6",children:(0,n.jsxs)(a.Zp,{children:[(0,n.jsxs)("div",{className:"flex items-start justify-between gap-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h1",{className:"text-2xl font-semibold tracking-tight",children:"Billing"}),(0,n.jsx)("p",{className:"mt-1 text-sm text-[color:var(--muted)]",children:"Manage your Coach subscription to unlock player contact info."})]}),(0,n.jsx)(a.$n,{type:"button",onClick:b,disabled:r,children:r?"Refreshing...":"Refresh"})]}),v?(0,n.jsxs)("div",{className:"mt-6 flex flex-wrap items-center gap-3",children:[(0,n.jsxs)("span",{className:"rounded-full border border-[color:var(--border)] bg-[var(--surface-soft)] px-2.5 py-1 text-xs font-semibold text-[color:var(--muted-2)]",children:["Status: ",p?"Active":"Inactive"]}),p&&g?(0,n.jsx)(a.$n,{type:"button",onClick:w,children:"Manage subscription"}):(0,n.jsxs)(n.Fragment,{children:[p&&!g?(0,n.jsx)("span",{className:"text-sm text-[color:var(--muted)]",children:"Your account is active, but a Stripe subscription hasn’t been created yet. Use Upgrade to create one."}):null,(0,n.jsxs)("div",{className:"flex items-center gap-2 rounded-2xl border border-[color:var(--border)] bg-[var(--surface-soft)] p-2",children:[(0,n.jsx)("button",{type:"button",onClick:()=>m("monthly"),className:"rounded-xl px-3 py-1.5 text-sm ".concat("monthly"===f?"bg-indigo-600 text-white":"text-[color:var(--muted)] hover:bg-[var(--surface)]"),children:"Monthly"}),(0,n.jsx)("button",{type:"button",onClick:()=>m("annual"),className:"rounded-xl px-3 py-1.5 text-sm ".concat("annual"===f?"bg-indigo-600 text-white":"text-[color:var(--muted)] hover:bg-[var(--surface)]"),children:"Annual"})]}),(0,n.jsxs)(a.$n,{type:"button",onClick:y,children:["Upgrade (",x,")"]})]})]}):(0,n.jsxs)("div",{className:"mt-6 rounded-2xl border border-[color:var(--border)] bg-[var(--surface-soft)] p-4",children:[(0,n.jsx)("div",{className:"text-sm font-semibold text-[color:var(--foreground)]",children:"Billing not configured"}),(0,n.jsx)("p",{className:"mt-1 text-sm text-[color:var(--muted)]",children:"Stripe isn’t configured yet for this environment. Contact an admin to finish setup."})]}),d?(0,n.jsx)("p",{className:"mt-4 text-sm text-red-300",children:d}):null]})})}},7541:(e,t,r)=>{"use strict";var n=r(3041);r.o(n,"useParams")&&r.d(t,{useParams:function(){return n.useParams}}),r.o(n,"usePathname")&&r.d(t,{usePathname:function(){return n.usePathname}}),r.o(n,"useRouter")&&r.d(t,{useRouter:function(){return n.useRouter}}),r.o(n,"useSearchParams")&&r.d(t,{useSearchParams:function(){return n.useSearchParams}})},7781:(e,t,r)=>{Promise.resolve().then(r.bind(r,2515)),Promise.resolve().then(r.bind(r,6355))}},e=>{e.O(0,[587,18,358],()=>e(e.s=7781)),_N_E=e.O()}]);