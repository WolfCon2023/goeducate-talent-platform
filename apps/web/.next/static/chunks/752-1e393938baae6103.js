"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[752],{2883:(e,t,r)=>{r.d(t,{X:()=>l,n:()=>n});var o=r(7011);class l extends Error{constructor(e){super(e.message),this.name="ApiFetchError",this.status=e.status,this.code=e.code,this.details=e.details}}async function n(e,t){var r,n,a,i,s;let c=function(){let e=o.env.NEXT_PUBLIC_API_URL;if(!e)throw Error("Missing NEXT_PUBLIC_API_URL");return e.replace(/\/+$/,"")}(),u=new Headers(null==t?void 0:t.headers);u.set("content-type","application/json"),(null==t?void 0:t.token)&&u.set("authorization","Bearer ".concat(t.token));let d=await fetch("".concat(c).concat(e),{...t,headers:u,cache:"no-store"});if(!d.ok){let e=await d.json().catch(()=>({}));throw new l({message:null!=(i=null==(r=e.error)?void 0:r.message)?i:"Request failed: ".concat(d.status),status:d.status,code:null==(n=e.error)?void 0:n.code,details:null==(a=e.error)?void 0:a.details})}if(204===d.status)return;if(!(null!=(s=d.headers.get("content-type"))?s:"").includes("application/json")){let e=await d.text();if(!e)return;return e}let h=await d.text();if(h)return JSON.parse(h)}},3996:(e,t,r)=>{r.d(t,{RoleGuard:()=>s});var o=r(4568),l=r(7541),n=r(7620),a=r(5979);let i={player:"/player",coach:"/coach",evaluator:"/evaluator",admin:"/admin"};function s(e){return!0!==function(e){let t=(0,l.useRouter)(),[r,o]=(0,n.useState)(null),s=e.join(",");return(0,n.useEffect)(()=>{let e=(0,a.iD)(),r=(0,a._u)(e);if(!e||!r){o(!1),t.push("/login");return}if(!new Set(s.split(",").filter(Boolean)).has(r)){var l;o(!1),t.push(null!=(l=i[r])?l:"/");return}o(!0)},[t,s]),r}(e.allowed)?null:(0,o.jsx)(o.Fragment,{children:e.children})}},4429:(e,t,r)=>{r.d(t,{ProfilePhotoUploader:()=>v});var o=r(4568),l=r(7620),n=r(4542),a=r(2883),i=r(5979),s=r(9948),c=r(3050),u=r(7509);async function d(e){return await new Promise((t,r)=>{let o=new Image;o.onload=()=>t(o),o.onerror=e=>r(e),o.src=e})}async function h(e){let t=await d(e.imageSrc),r=document.createElement("canvas");r.width=Math.max(1,Math.floor(e.crop.width)),r.height=Math.max(1,Math.floor(e.crop.height));let o=r.getContext("2d");if(!o)throw Error("Canvas not supported");o.drawImage(t,e.crop.x,e.crop.y,e.crop.width,e.crop.height,0,0,e.crop.width,e.crop.height);let l=await new Promise(t=>r.toBlob(e=>t(e),e.mime,.9));if(!l)throw Error("Failed to create cropped image");return l}function f(e){let[t,r]=(0,l.useState)(!1),[a,i]=(0,l.useState)({x:0,y:0}),[s,d]=(0,l.useState)(1),[f,m]=(0,l.useState)(null),[p,v]=(0,l.useState)(!1);(0,l.useEffect)(()=>{r(!0)},[]);let w=(0,l.useMemo)(()=>URL.createObjectURL(e.file),[e.file]);async function x(){if(f){v(!0);try{let t="image/jpeg",r=await h({imageSrc:w,crop:f,mime:t}),o=new File([r],"profile-photo.jpg",{type:t});e.onConfirm(o)}finally{v(!1)}}}return((0,l.useEffect)(()=>()=>URL.revokeObjectURL(w),[w]),(0,l.useEffect)(()=>{function t(t){"Escape"===t.key&&e.onCancel()}return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[e]),(0,l.useEffect)(()=>{let e=document.body.style.overflow;return document.body.style.overflow="hidden",()=>{document.body.style.overflow=e}},[]),t)?(0,u.createPortal)((0,o.jsx)("div",{className:"fixed inset-0 z-[110] flex items-center justify-center bg-black/80 p-4 backdrop-blur-sm",role:"dialog","aria-modal":"true",onMouseDown:t=>{t.currentTarget===t.target&&e.onCancel()},children:(0,o.jsxs)("div",{className:"w-full max-w-3xl rounded-2xl border border-white/10 bg-[var(--surface)] p-4",children:[(0,o.jsxs)("div",{className:"flex flex-wrap items-start justify-between gap-3",children:[(0,o.jsxs)("div",{children:[(0,o.jsx)("div",{className:"text-sm font-semibold text-white",children:"Crop profile photo"}),(0,o.jsx)("div",{className:"mt-1 text-sm text-white/70",children:"Drag to reposition and zoom. Weâ€™ll crop to a square for the circular avatar."})]}),(0,o.jsxs)("div",{className:"flex items-center gap-2",children:[(0,o.jsx)(n.$n,{type:"button",onClick:e.onCancel,disabled:p,className:"border border-white/15 bg-white/5 hover:bg-white/10",children:"Cancel"}),(0,o.jsx)(n.$n,{type:"button",onClick:x,disabled:p||!f,children:p?"Cropping...":"Use photo"})]})]}),(0,o.jsx)("div",{className:"mt-4 overflow-hidden rounded-xl border border-white/10 bg-black/40",children:(0,o.jsx)("div",{className:"relative h-[55vh] max-h-[520px] w-full",children:(0,o.jsx)(c.Ay,{image:w,crop:a,zoom:s,aspect:1,cropShape:"round",showGrid:!1,onCropChange:i,onZoomChange:d,onCropComplete:(e,t)=>m(t)})})}),(0,o.jsxs)("div",{className:"mt-4 flex items-center gap-3",children:[(0,o.jsx)("div",{className:"text-xs text-white/70",children:"Zoom"}),(0,o.jsx)("input",{type:"range",min:1,max:3,step:.01,value:s,onChange:e=>d(Number(e.target.value)),className:"w-full"})]})]})}),document.body):null}var m=r(7011);function p(){let e=m.env.NEXT_PUBLIC_API_URL;if(!e)throw Error("Missing NEXT_PUBLIC_API_URL");return e.replace(/\/+$/,"")}function v(e){var t,r;let c=(0,l.useRef)(null),[u,d]=(0,l.useState)(null),[h,m]=(0,l.useState)(!1),[v,w]=(0,l.useState)(null),[x,g]=(0,l.useState)(0),[b,y]=(0,l.useState)(!1),[j,N]=(0,l.useState)(null);async function C(e){d(null),m(!0);try{let o=(0,i.iD)(),l=(0,i._u)(o);if(!o)throw Error("Please login first.");if("player"!==l&&"coach"!==l)throw Error("Only players and coaches can upload profile photos.");if(!e.type.startsWith("image/"))throw Error("Please choose an image file.");if(e.size>5242880)throw Error("Image is too large (max 5MB).");let n=new FormData;n.append("file",e);let a=await fetch("".concat(p(),"/users/me/profile-photo"),{method:"POST",headers:{authorization:"Bearer ".concat(o)},body:n}),s=await a.json().catch(()=>({}));if(!a.ok){var t,r;let e=null!=(r=null==s||null==(t=s.error)?void 0:t.message)?r:"Upload failed";throw Error(e)}d("Profile photo updated."),w((null==s?void 0:s.profilePhotoUrl)?String(s.profilePhotoUrl):null),g(Date.now()),window.dispatchEvent(new Event("goeducate:me-changed"))}finally{m(!1),c.current&&(c.current.value="")}}(0,l.useEffect)(()=>{let e=!1;async function t(){let t=(0,i.iD)();if(!t)return;let r=await (0,a.n)("/auth/me",{token:t}).catch(()=>null);if(!e){var o,l;w(null!=(l=null==r||null==(o=r.user)?void 0:o.profilePhotoUrl)?l:null),g(Date.now())}}t();let r=()=>void t();return window.addEventListener("goeducate:me-changed",r),()=>{e=!0,window.removeEventListener("goeducate:me-changed",r)}},[]);let E=v?"".concat(p()).concat(v,"?v=").concat(x):null;return(0,o.jsxs)(n.Zp,{children:[(0,o.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[(0,o.jsxs)("div",{children:[(0,o.jsx)("div",{className:"text-sm font-semibold",children:null!=(t=e.title)?t:"Profile photo"}),(0,o.jsx)("p",{className:"mt-1 text-sm text-white/80",children:null!=(r=e.help)?r:"Upload a headshot or clear face photo (JPG/PNG/WebP, max 5MB)."}),u?(0,o.jsx)("div",{className:"mt-2 text-sm text-white/80",children:u}):null]}),(0,o.jsxs)("div",{className:"flex items-center gap-2",children:[v?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("button",{type:"button",onClick:()=>y(!0),className:"rounded-full focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-white/60","aria-label":"View profile photo",title:"Click to enlarge",children:(0,o.jsx)("img",{src:null!=E?E:"".concat(p()).concat(v),alt:"Profile photo",className:"h-10 w-10 rounded-full border border-white/10 object-cover"})}),b?(0,o.jsx)(s.B,{src:null!=E?E:"".concat(p()).concat(v),alt:"Profile photo",onClose:()=>y(!1)}):null]}):null,(0,o.jsx)("input",{ref:c,type:"file",accept:"image/*",className:"hidden",onChange:e=>{var t;let r=null==(t=e.target.files)?void 0:t[0];r&&N(r)}}),(0,o.jsx)(n.$n,{type:"button",onClick:()=>{var e;return null==(e=c.current)?void 0:e.click()},disabled:h,children:h?"Uploading...":"Upload photo"})]})]}),j?(0,o.jsx)(f,{file:j,onCancel:()=>{N(null),c.current&&(c.current.value="")},onConfirm:e=>{N(null),C(e)}}):null]})}},4542:(e,t,r)=>{r.d(t,{$n:()=>l,JU:()=>a,Zp:()=>i,pd:()=>n});var o=r(4568);function l(e){let{className:t="",...r}=e;return(0,o.jsx)("button",{className:"rounded-md bg-indigo-600 px-4 py-2 text-sm font-medium text-white hover:bg-indigo-500 disabled:opacity-60 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[color:var(--color-primary-600)] ".concat(t),...r})}function n(e){let{className:t="",...r}=e;return(0,o.jsx)("input",{className:"w-full rounded-md border border-[color:var(--border)] bg-[var(--surface-soft)] px-3 py-2 text-sm text-[color:var(--foreground)] placeholder:text-[color:var(--muted-3)] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[color:var(--color-primary-600)] ".concat(t),...r})}function a(e){return(0,o.jsx)("label",{htmlFor:e.htmlFor,className:"text-sm font-medium text-[color:var(--muted)]",children:e.children})}function i(e){return(0,o.jsx)("div",{className:"rounded-2xl border border-[color:var(--border)] bg-[var(--surface)] p-6",children:e.children})}},5979:(e,t,r)=>{r.d(t,{QG:()=>i,_u:()=>a,bZ:()=>c,iD:()=>l,ki:()=>s});let o="goeducate_access_token";function l(){return window.localStorage.getItem(o)}function n(e){let t="=".repeat((4-e.length%4)%4);return decodeURIComponent(atob((e+t).replace(/-/g,"+").replace(/_/g,"/")).split("").map(e=>"%".concat(e.charCodeAt(0).toString(16).padStart(2,"0"))).join(""))}function a(e){if(!e)return null;let t=e.split(".");if(3!==t.length)return null;try{var r;let e=JSON.parse(n(null!=(r=t[1])?r:""));return"string"==typeof(null==e?void 0:e.role)?e.role:null}catch(e){return null}}function i(e){if(!e)return null;let t=e.split(".");if(3!==t.length)return null;try{var r;let e=JSON.parse(n(null!=(r=t[1])?r:""));return"string"==typeof(null==e?void 0:e.sub)?e.sub:null}catch(e){return null}}function s(e){window.localStorage.setItem(o,e)}function c(){window.localStorage.removeItem(o)}},9948:(e,t,r)=>{r.d(t,{B:()=>a});var o=r(4568),l=r(7620),n=r(7509);function a(e){var t;let[r,a]=(0,l.useState)(!1);return((0,l.useEffect)(()=>{a(!0)},[]),(0,l.useEffect)(()=>{function t(t){"Escape"===t.key&&e.onClose()}return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[e]),(0,l.useEffect)(()=>{let e=document.body.style.overflow;return document.body.style.overflow="hidden",()=>{document.body.style.overflow=e}},[]),r)?(0,n.createPortal)((0,o.jsx)("div",{className:"fixed inset-0 z-[100] flex items-center justify-center bg-black/80 p-4 backdrop-blur-sm",role:"dialog","aria-modal":"true",onMouseDown:t=>{t.currentTarget===t.target&&e.onClose()},children:(0,o.jsxs)("div",{className:"flex max-h-[92vh] w-full max-w-4xl flex-col",children:[(0,o.jsx)("div",{className:"mb-3 flex items-center justify-end",children:(0,o.jsx)("button",{type:"button",onClick:e.onClose,className:"rounded-md border border-white/15 bg-white/5 px-3 py-1.5 text-sm text-white hover:bg-white/10 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-white/60",children:"Close"})}),(0,o.jsx)("div",{className:"min-h-0 overflow-auto rounded-2xl border border-white/10 bg-white/5 p-2",children:(0,o.jsx)("img",{src:e.src,alt:null!=(t=e.alt)?t:"Image",className:"mx-auto max-h-[82vh] w-auto max-w-full object-contain"})})]})}),document.body):null}}}]);